SELECT COD_ALUNO,
       CASE
         WHEN TRUNC(DATA) IS NULL AND COD_ALUNO IS NOT NULL
             THEN 'SUB-TOTAL'
         WHEN COD_ALUNO IS NULL
             THEN 'TOTAL-GERAL'
         ELSE TO_CHAR( Trunc(DATA) )
       END DESCRICAO,
       Round(AVG(DESCONTO),2) DESCONTO,
       SUM(TOTAL) TOTAL
FROM   TCONTRATO
GROUP  BY ROLLUP(COD_ALUNO, TRUNC(DATA) )